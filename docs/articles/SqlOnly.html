<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running the DQD in SqlOnly mode • DataQualityDashboard</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Running the DQD in SqlOnly mode">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DataQualityDashboard</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.8.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../articles/DataQualityDashboard.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Thresholds.html">DQ Check Failure Thresholds</a>
    </li>
    <li>
      <a href="../articles/CheckStatusDefinitions.html">DQ Check Statuses</a>
    </li>
    <li>
      <a href="../articles/AddNewCheck.html">Adding a New Data Quality Check</a>
    </li>
    <li>
      <a href="../articles/DqdForCohorts.html">DQD for Cohorts</a>
    </li>
    <li>
      <a href="../articles/SqlOnly.html">SQL-only Mode</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data Quality Check Types

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/checkIndex.html">Index</a>
    </li>
    <li>
      <a href="../articles/checks/cdmTable.html">cdmTable</a>
    </li>
    <li>
      <a href="../articles/checks/cdmField.html">cdmField</a>
    </li>
    <li>
      <a href="../articles/checks/cdmDatatype.html">cdmDatatype</a>
    </li>
    <li>
      <a href="../articles/checks/isPrimaryKey.html">isPrimaryKey</a>
    </li>
    <li>
      <a href="../articles/checks/isForeignKey.html">isForeignKey</a>
    </li>
    <li>
      <a href="../articles/checks/isRequired.html">isRequired</a>
    </li>
    <li>
      <a href="../articles/checks/fkDomain.html">fkDomain</a>
    </li>
    <li>
      <a href="../articles/checks/fkClass.html">fkClass</a>
    </li>
    <li>
      <a href="../articles/checks/measurePersonCompleteness.html">measurePersonCompleteness</a>
    </li>
    <li>
      <a href="../articles/checks/measureValueCompleteness.html">measureValueCompleteness</a>
    </li>
    <li>
      <a href="../articles/checks/isStandardValidConcept.html">isStandardValidConcept</a>
    </li>
    <li>
      <a href="../articles/checks/standardConceptRecordCompleteness.html">standardConceptRecordCompleteness</a>
    </li>
    <li>
      <a href="../articles/checks/sourceConceptRecordCompleteness.html">sourceConceptRecordCompleteness</a>
    </li>
    <li>
      <a href="../articles/checks/sourceValueCompleteness.html">sourceValueCompleteness</a>
    </li>
    <li>
      <a href="../articles/checks/plausibleAfterBirth.html">plausibleAfterBirth</a>
    </li>
    <li>
      <a href="../articles/checks/plausibleBeforeDeath.html">plausibleBeforeDeath</a>
    </li>
    <li>
      <a href="../articles/checks/plausibleStartBeforeEnd.html">plausibleStartBeforeEnd</a>
    </li>
    <li>
      <a href="../articles/checks/plausibleValueHigh.html">plausibleValueHigh</a>
    </li>
    <li>
      <a href="../articles/checks/plausibleValueLow.html">plausibleValueLow</a>
    </li>
    <li>
      <a href="../articles/checks/withinVisitDates.html">withinVisitDates</a>
    </li>
    <li>
      <a href="../articles/checks/measureConditionEraCompleteness.html">measureConditionEraCompleteness</a>
    </li>
    <li>
      <a href="../articles/checks/measureObservationPeriodOverlap.html">measureObservationPeriodOverlap</a>
    </li>
    <li>
      <a href="../articles/checks/plausibleUnitConceptIds.html">plausibleUnitConceptIds</a>
    </li>
    <li>
      <a href="../articles/checks/plausibleGenderUseDescendants.html">plausibleGenderUseDescendants</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/DataQualityDashboard/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Running the DQD in SqlOnly mode</h1>
                        <h4 data-toc-skip class="author">Maxim
Moinat</h4>
            
            <h4 data-toc-skip class="date">2025-09-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/DataQualityDashboard/blob/HEAD/vignettes/SqlOnly.rmd" class="external-link"><code>vignettes/SqlOnly.rmd</code></a></small>
      <div class="hidden name"><code>SqlOnly.rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h2>
<p>This article describes how to use DQD to generate only the SQL that
executes all DataQualityDashboard checks, without actually executing
them. There are a few main advantages of running DQD in Sql-only
mode:</p>
<ul>
<li>Create queries locally, before sending to server. This allows for
generation of the SQL on one machine and execution on another (e.g. when
R cannot connect directly to the database server, or you want to run the
DQD SQL as part of your ETL).</li>
<li>Since these are fully functional queries, this can help with
debugging.</li>
<li>
<strong>[NEW in v2.3.0!]</strong> Performance. If you use
<code>sqlOnlyIncrementalInsert = TRUE</code> and
<code>sqlOnlyUnionCount &gt; 1</code>, multiple checks are unioned
within a cte in the output SQL query to speed performance. When testing
on Spark, this resulted in a 10x or higher performance gain.
<ul>
<li>Performance for these queries has NOT been benchmarked on all
database systems. In order to obtain optimal results in your database
you may need to adjust the <code>sqlOnlyUnionCount</code> and/or tune
database parameters such as indexing and parallelism</li>
</ul>
</li>
</ul>
<p>The new <code>sqlOnlyIncrementalInsert</code> mode generates SQL
queries that will actually populate a DQD results table in your database
with the results of the checks. There are currently some differences in
the result when running these queries, compared to a normal DQD run:</p>
<ul>
<li>If you set <code>sqlOnlyUnionCount</code> &gt; 1, if one check
results in an error, multiple checks might fail (since the queries are
unioned in ctes).</li>
<li>The status <code>not_applicable</code> is not evaluated. A check
fails or passes.</li>
<li>The query text is not shown in the results table.</li>
<li>Notes from threshold file are not included in results.</li>
<li>Execution metadata is not automatically added (total and query
execution time; CDM_SOURCE metadata).</li>
</ul>
<p>Running DQD with <code>sqlOnly = TRUE</code> and
<code>sqlOnlyIncrementalInsert = FALSE</code> will generate SQL queries
that can be run to generate the result of each DQ check, but which will
not write the results back to the database.</p>
</div>
<div class="section level2">
<h2 id="generating-the-incremental-insert-dqd-sql">Generating the “Incremental Insert” DQD SQL<a class="anchor" aria-label="anchor" href="#generating-the-incremental-insert-dqd-sql"></a>
</h2>
<p>A few things to note:</p>
<ul>
<li>A dummy <code>connectionDetails</code> object is needed where only
the <code>dbms</code> is used during SQL-only execution.
<ul>
<li>By setting the dbms to ‘sql server’ the output SQL can still be
rendered to any other dialect using <code>SqlRender</code> (see example
below).</li>
</ul>
</li>
<li>
<code>sqlOnlyUnionCount</code> determines the number of check sqls
to union in a single query. A smaller number gives more control and
progress information, a higher number typically gives a higher
performance. Here, 100 is used.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OHDSI/DataQualityDashboard" class="external-link">DataQualityDashboard</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ConnectionDetails object needed for sql dialect</span></span>
<span><span class="va">dbmsConnectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span></span>
<span>  dbms <span class="op">=</span> <span class="st">"sql server"</span>,  <span class="co"># can be rendered to any dbms upon execution</span></span>
<span>  pathToDriver <span class="op">=</span> <span class="st">"/"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Database parameters that are pre-filled in the written queries</span></span>
<span><span class="co"># Use @-syntax if creating a template-sql at execution-time (e.g. "@cdmDatabaseSchema")</span></span>
<span><span class="va">cdmDatabaseSchema</span> <span class="op">&lt;-</span> <span class="st">"@cdmDatabaseSchema"</span>   <span class="co"># the fully qualified database schema name of the CDM</span></span>
<span><span class="va">resultsDatabaseSchema</span> <span class="op">&lt;-</span> <span class="st">"@resultsDatabaseSchema"</span>   <span class="co"># the fully qualified database schema name of the results schema (that you can write to)</span></span>
<span><span class="va">writeTableName</span> <span class="op">&lt;-</span> <span class="st">"@writeTableName"</span></span>
<span></span>
<span><span class="va">sqlFolder</span> <span class="op">&lt;-</span> <span class="st">"./results_sql_only"</span></span>
<span><span class="va">cdmSourceName</span> <span class="op">&lt;-</span> <span class="st">"Synthea"</span></span>
<span></span>
<span><span class="va">sqlOnly</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">sqlOnlyIncrementalInsert</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>    <span class="co"># this will generate an insert SQL query for each check type that will compute check results and insert them into a database table</span></span>
<span><span class="va">sqlOnlyUnionCount</span> <span class="op">&lt;-</span> <span class="fl">100</span>            <span class="co"># this unions up to 100 queries in each insert query</span></span>
<span></span>
<span><span class="va">verboseMode</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span><span class="va">cdmVersion</span> <span class="op">&lt;-</span> <span class="st">"5.4"</span></span>
<span><span class="va">checkLevels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TABLE"</span>, <span class="st">"FIELD"</span>, <span class="st">"CONCEPT"</span><span class="op">)</span></span>
<span><span class="va">tablesToExclude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">checkNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run DQD with sqlOnly=TRUE and sqlOnlyIncrementalInsert=TRUE. This will create a sql file for each check type in the output folder</span></span>
<span><span class="fu">DataQualityDashboard</span><span class="fu">::</span><span class="fu"><a href="../reference/executeDqChecks.html">executeDqChecks</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">dbmsConnectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  resultsDatabaseSchema <span class="op">=</span> <span class="va">resultsDatabaseSchema</span>,</span>
<span>  writeTableName <span class="op">=</span> <span class="va">writeTableName</span>,</span>
<span>  cdmSourceName <span class="op">=</span> <span class="va">cdmSourceName</span>,</span>
<span>  sqlOnly <span class="op">=</span> <span class="va">sqlOnly</span>,</span>
<span>  sqlOnlyUnionCount <span class="op">=</span> <span class="va">sqlOnlyUnionCount</span>,</span>
<span>  sqlOnlyIncrementalInsert <span class="op">=</span> <span class="va">sqlOnlyIncrementalInsert</span>,</span>
<span>  outputFolder <span class="op">=</span> <span class="va">sqlFolder</span>,</span>
<span>  checkLevels <span class="op">=</span> <span class="va">checkLevels</span>,</span>
<span>  verboseMode <span class="op">=</span> <span class="va">verboseMode</span>,</span>
<span>  cdmVersion <span class="op">=</span> <span class="va">cdmVersion</span>,</span>
<span>  tablesToExclude <span class="op">=</span> <span class="va">tablesToExclude</span>,</span>
<span>  checkNames <span class="op">=</span> <span class="va">checkNames</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After running above code, you will end up with a number of sql files
in the specified output directory:</p>
<ul>
<li>One sql file per check type:
<code>TABLE|FIELD|CONCEPT_&lt;check_name&gt;.sql</code>.</li>
<li>
<code>ddlDqdResults.sql</code> with the result table creation
query.</li>
</ul>
<p>The queries can then be run in any SQL client, making sure to run
<code>ddlDqdResults.sql</code> first. The order of the check queries is
not important, and can even be run in parallel. This will run the check,
and store the result in the specified <code>writeTableName</code>. In
order to show this result in the DQD Dashboard Shiny app, this table has
to be exported and converted to the .json format. See below for example
code of how this can be achieved.</p>
</div>
<div class="section level2">
<h2 id="optional-execute-queries">(OPTIONAL) Execute queries<a class="anchor" aria-label="anchor" href="#optional-execute-queries"></a>
</h2>
<p>Below code snippet shows how you can run the generated queries on an
OMOP CDM database using OHDSI R packages, and display the results in the
DQD Dashboard. Note that this approach uses two non-exported DQD
functions (<code>.summarizeResults</code>,
<code>.writeResultsToJson</code>) that are not tested for this purpose.
In the future we plan to expand support for incremental-insert mode with
a more robust set of public functions. Please reach out with feedback on
our <a href="https://github.com/OHDSI/DataQualityDashboard/issues" class="external-link">GitHub
page</a> if you’d like to have input on the development of this new
feature!</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/DatabaseConnector/" class="external-link">DatabaseConnector</a></span><span class="op">)</span></span>
<span><span class="va">cdmSourceName</span> <span class="op">&lt;-</span> <span class="st">"&lt;YourSourceName&gt;"</span></span>
<span><span class="va">sqlFolder</span> <span class="op">&lt;-</span> <span class="st">"./results_sql_only"</span></span>
<span><span class="va">jsonOutputFolder</span> <span class="op">&lt;-</span> <span class="va">sqlFolder</span></span>
<span><span class="va">jsonOutputFile</span> <span class="op">&lt;-</span> <span class="st">"sql_only_results.json"</span></span>
<span></span>
<span><span class="va">dbms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DBMS"</span><span class="op">)</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_SERVER"</span><span class="op">)</span></span>
<span><span class="va">port</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_PORT"</span><span class="op">)</span></span>
<span><span class="va">user</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_USER"</span><span class="op">)</span></span>
<span><span class="va">password</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_PASSWORD"</span><span class="op">)</span></span>
<span><span class="va">pathToDriver</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"PATH_TO_DRIVER"</span><span class="op">)</span></span>
<span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span></span>
<span>  dbms <span class="op">=</span> <span class="va">dbms</span>,</span>
<span>  server <span class="op">=</span> <span class="va">server</span>,</span>
<span>  port <span class="op">=</span> <span class="va">port</span>,</span>
<span>  user <span class="op">=</span> <span class="va">user</span>,</span>
<span>  password <span class="op">=</span> <span class="va">password</span>,</span>
<span>  pathToDriver <span class="op">=</span> <span class="va">pathToDriver</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdmDatabaseSchema</span> <span class="op">&lt;-</span> <span class="st">'&lt;YourCdmSchemaName&gt;'</span></span>
<span><span class="va">resultsDatabaseSchema</span> <span class="op">&lt;-</span> <span class="st">'&lt;YourResultsSchemaName&gt;'</span></span>
<span><span class="va">writeTableName</span> <span class="op">&lt;-</span> <span class="st">'dqd_results'</span> <span class="co"># or whatever you want to name your results table</span></span>
<span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html" class="external-link">connect</a></span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create results table</span></span>
<span><span class="va">ddlFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">sqlFolder</span>, <span class="st">"ddlDqdResults.sql"</span><span class="op">)</span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/renderTranslateExecuteSql.html" class="external-link">renderTranslateExecuteSql</a></span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">c</span>,</span>
<span>  sql <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readChar.html" class="external-link">readChar</a></span><span class="op">(</span><span class="va">ddlFile</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">ddlFile</span><span class="op">)</span><span class="op">$</span><span class="va">size</span><span class="op">)</span>,</span>
<span>  resultsDatabaseSchema <span class="op">=</span> <span class="va">resultsDatabaseSchema</span>,</span>
<span>  writeTableName <span class="op">=</span> <span class="va">writeTableName</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run checks</span></span>
<span><span class="va">dqdSqlFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.glob.html" class="external-link">Sys.glob</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">sqlFolder</span>, <span class="st">"*.sql"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">dqdSqlFile</span> <span class="kw">in</span> <span class="va">dqdSqlFiles</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">dqdSqlFile</span> <span class="op">==</span> <span class="va">ddlFile</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">next</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dqdSqlFile</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    expr <span class="op">=</span> <span class="op">{</span></span>
<span>      <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/renderTranslateExecuteSql.html" class="external-link">renderTranslateExecuteSql</a></span><span class="op">(</span></span>
<span>        connection <span class="op">=</span> <span class="va">c</span>,</span>
<span>        sql <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readChar.html" class="external-link">readChar</a></span><span class="op">(</span><span class="va">dqdSqlFile</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">dqdSqlFile</span><span class="op">)</span><span class="op">$</span><span class="va">size</span><span class="op">)</span>,</span>
<span>        cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>        resultsDatabaseSchema <span class="op">=</span> <span class="va">resultsDatabaseSchema</span>,</span>
<span>        writeTableName <span class="op">=</span> <span class="va">writeTableName</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Writing table failed for check %s with error %s"</span>, <span class="va">dqdSqlFile</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Extract results table to JSON file for viewing or secondary use</span></span>
<span></span>
<span><span class="fu">DataQualityDashboard</span><span class="fu">::</span><span class="fu"><a href="../reference/writeDBResultsToJson.html">writeDBResultsToJson</a></span><span class="op">(</span></span>
<span>    <span class="va">c</span>,</span>
<span>    <span class="va">connectionDetails</span>,</span>
<span>    <span class="va">resultsDatabaseSchema</span>,</span>
<span>    <span class="va">cdmDatabaseSchema</span>,</span>
<span>    <span class="va">writeTableName</span>,</span>
<span>    <span class="va">jsonOutputFolder</span>,</span>
<span>    <span class="va">jsonOutputFile</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">jsonFilePath</span> <span class="op">&lt;-</span> <span class="fu">R.utils</span><span class="fu">::</span><span class="fu"><a href="https://henrikbengtsson.github.io/R.utils/reference/getAbsolutePath.html" class="external-link">getAbsolutePath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">jsonOutputFolder</span>, <span class="va">jsonOutputFile</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">DataQualityDashboard</span><span class="fu">::</span><span class="fu"><a href="../reference/viewDqDashboard.html">viewDqDashboard</a></span><span class="op">(</span><span class="va">jsonFilePath</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Katy Sadowski, Clair Blacketer, Maxim Moinat, Ajit Londhe, Anthony Sena, Anthony Molinaro, Frank DeFalco, Pavel Grafkin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer>
</div>






  </body>
</html>
