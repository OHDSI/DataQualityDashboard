<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>withinVisitDates • DataQualityDashboard</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="withinVisitDates">
<meta property="og:description" content="DataQualityDashboard">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">DataQualityDashboard</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.6.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/DataQualityDashboard.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/CheckTypeDescriptions.html">Check Type Definitions</a>
    </li>
    <li>
      <a href="../../articles/Thresholds.html">DQ Check Failure Thresholds</a>
    </li>
    <li>
      <a href="../../articles/CheckStatusDefinitions.html">DQ Check Statuses</a>
    </li>
    <li>
      <a href="../../articles/AddNewCheck.html">Adding a New Data Quality Check</a>
    </li>
    <li>
      <a href="../../articles/DqdForCohorts.html">DQD for Cohorts</a>
    </li>
    <li>
      <a href="../../articles/SqlOnly.html">SQL-only Mode</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    NEW! Data Quality Check Types
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/checkIndex.html">Index</a>
    </li>
    <li>
      <a href="../../articles/checks/cdmTable.html">cdmTable</a>
    </li>
    <li>
      <a href="../../articles/checks/cdmField.html">cdmField</a>
    </li>
    <li>
      <a href="../../articles/checks/cdmDatatype.html">cdmDatatype</a>
    </li>
    <li>
      <a href="../../articles/checks/isPrimaryKey.html">isPrimaryKey</a>
    </li>
    <li>
      <a href="../../articles/checks/isForeignKey.html">isForeignKey</a>
    </li>
    <li>
      <a href="../../articles/checks/isRequired.html">isRequired</a>
    </li>
    <li>
      <a href="../../articles/checks/fkDomain.html">fkDomain</a>
    </li>
    <li>
      <a href="../../articles/checks/fkClass.html">fkClass</a>
    </li>
    <li>
      <a href="../../articles/checks/measurePersonCompleteness.html">measurePersonCompleteness</a>
    </li>
    <li>
      <a href="../../articles/checks/measureValueCompleteness.html">measureValueCompleteness</a>
    </li>
    <li>
      <a href="../../articles/checks/isStandardValidConcept.html">isStandardValidConcept</a>
    </li>
    <li>
      <a href="../../articles/checks/standardConceptRecordCompleteness.html">standardConceptRecordCompleteness</a>
    </li>
    <li>
      <a href="../../articles/checks/sourceConceptRecordCompleteness.html">sourceConceptRecordCompleteness</a>
    </li>
    <li>
      <a href="../../articles/checks/sourceValueCompleteness.html">sourceValueCompleteness</a>
    </li>
    <li>
      <a href="../../articles/checks/plausibleAfterBirth.html">plausibleAfterBirth</a>
    </li>
    <li>
      <a href="../../articles/checks/plausibleBeforeDeath.html">plausibleBeforeDeath</a>
    </li>
    <li>
      <a href="../../articles/checks/plausibleStartBeforeEnd.html">plausibleStartBeforeEnd</a>
    </li>
    <li>
      <a href="../../articles/checks/plausibleValueHigh.html">plausibleValueHigh</a>
    </li>
    <li>
      <a href="../../articles/checks/plausibleValueLow.html">plausibleValueLow</a>
    </li>
    <li>
      <a href="../../articles/checks/withinVisitDates.html">withinVisitDates</a>
    </li>
    <li>
      <a href="../../articles/checks/measureConditionEraCompleteness.html">measureConditionEraCompleteness</a>
    </li>
    <li>
      <a href="../../articles/checks/plausibleUnitConceptIds.html">plausibleUnitConceptIds</a>
    </li>
    <li>
      <a href="../../articles/checks/plausibleGenderUseDescendants.html">plausibleGenderUseDescendants</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/DataQualityDashboard/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>withinVisitDates</h1>
                        <h4 data-toc-skip class="author">Clair
Blacketer</h4>
            
            <h4 data-toc-skip class="date">2024-12-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/DataQualityDashboard/blob/HEAD/vignettes/checks/withinVisitDates.Rmd" class="external-link"><code>vignettes/checks/withinVisitDates.Rmd</code></a></small>
      <div class="hidden name"><code>withinVisitDates.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p><strong>Level</strong>: FIELD<br><strong>Context</strong>: Verification<br><strong>Category</strong>: Plausibility<br><strong>Subcategory</strong>:<br><strong>Severity</strong>: Characterization ✔</p>
</div>
<div class="section level2">
<h2 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h2>
<p>The number and percent of records that occur one week before the
corresponding <code>visit_start_date</code> or one week after the
corresponding <code>visit_end_date</code></p>
</div>
<div class="section level2">
<h2 id="definition">Definition<a class="anchor" aria-label="anchor" href="#definition"></a>
</h2>
<ul>
<li>
<em>Numerator</em>: The number of rows in a table where the event
date occurs more than 7 days prior to the corresponding visit start date
or more than 7 days after the corresponding visit end date.</li>
<li>
<em>Denominator</em>: The total number of rows in the table with a
corresponding visit (linked through
<code>visit_occurrence_id</code>)</li>
<li>
<em>Related CDM Convention(s)</em>: There is no explicit convention
tied to this check. However, the CDM documentation describes the
<code>visit_occurrence_id</code> foreign key in the event tables as “The
visit during which the <event> occurred.” The underlying assumption is
that if a record is tied to a visit, then the date of the record should
fall in some reasonable time period around the visit dates. This gives a
week of leeway on either side for physician notes or other activities
related to a visit to be recorded.<br></event>
</li>
<li>
<em>CDM Fields/Tables</em>: This check runs on all event tables:
<code>CONDITION_OCCURRENCE</code>, <code>PROCEDURE_OCCURRENCE</code>,
<code>DRUG_EXPOSURE</code>, <code>DEVICE_EXPOSURE</code>,
<code>MEASUREMENT</code>, <code>NOTE</code>, <code>OBSERVATION</code>,
and <code>VISIT_DETAIL</code>. It will check either the
<code>X_date</code> or <code>X_start_date</code> fields for alignment
with corresponding <code>VISIT_OCCURRENCE</code> dates by linking on the
<code>visit_occurrence_id</code>. (<strong>Note:</strong> For
VISIT_DETAIL it will check both the visit_detail_start_date and
visit_detail_end_date. The default threshold for these two checks is
1%.)</li>
<li>
<em>Default Threshold Value</em>:
<ul>
<li>1% for <code>VISIT_DETAIL</code>
</li>
<li>5% for all other tables</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="user-guidance">User Guidance<a class="anchor" aria-label="anchor" href="#user-guidance"></a>
</h2>
<p>There is no explicit convention that describes how events should
align temporally with the visits they correspond to. This check is meant
to identify egregious mismatches in dates that could signify an
incorrect date field was used in the ETL or that the data should be used
with caution if there is no reason for the mismatch (history of a
condition, for example).</p>
<p>If this check fails the first action should be to investigate the
failing rows for any patterns. The main query to find failing rows is
below:</p>
<div class="section level3">
<h3 id="violated-rows-query">Violated rows query<a class="anchor" aria-label="anchor" href="#violated-rows-query"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="st">'@cdmTableName.@cdmFieldName'</span> <span class="kw">AS</span> violating_field,  </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  vo.visit_start_date, vo.visit_end_date, vo.person_id, </span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  cdmTable.<span class="op">*</span> </span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="kw">FROM</span> @cdmDatabaseSchema.@cdmTableName cdmTable </span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="kw">JOIN</span> @cdmDatabaseSchema.visit_occurrence vo </span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="kw">ON</span> cdmTable.visit_occurrence_id <span class="op">=</span> vo.visit_occurrence_id </span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="kw">WHERE</span> cdmTable.@cdmFieldName <span class="op">&lt;</span> dateadd(<span class="dt">day</span>, <span class="op">-</span><span class="dv">7</span>, vo.visit_start_date) </span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="kw">OR</span> cdmTable.@cdmFieldName <span class="op">&gt;</span> dateadd(<span class="dt">day</span>, <span class="dv">7</span>, vo.visit_end_date) </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="etl-developers">ETL Developers<a class="anchor" aria-label="anchor" href="#etl-developers"></a>
</h3>
<p>The first step is to investigate whether visit and event indeed
should be linked - e.g., do they belong to the same person; how far are
the dates apart; is it possible the event was recorded during the visit.
If they should be linked, then the next step is to investigate which of
the event date and visit date is accurate.</p>
<p>One suggestion would be to identify if all of the failures are due to
many events all having the same date. In some institutions there is a
default date given to events in the case where a date is not given.
Should this be the problem, the first step should be to identify if
there is a different date field in the native data that can be used. If
not, considerations should be made to determine if the rows should be
dropped. Without a correct date it is challenging to use such events in
health outcomes research.</p>
<p>Another reason for the discrepancy could be that the wrong date has
been used for events. For instance, in some systems a diagnosis could
have both an ‘observation date’ and an ‘administration date’. If the
physician is updating records at a later date, the administration date
can be later than the actual date the diagnosis was observed. In those
cases, the observation date has to be used. If there is only an
administration date, it is in some cases arguable to use the visit date
for the diagnosis date.</p>
<p>Another suggestion would be to investigate if the failures are
related to ‘History of’ conditions. It is often the case that a
patient’s history is recorded during a visit, in which case they may
report a diagnosis date prior to the given visit. In some cases it may
be appropriate to conserve these records; the decision to do so will
depend on the reliability of the recorded date in your source data.</p>
</div>
<div class="section level3">
<h3 id="data-users">Data Users<a class="anchor" aria-label="anchor" href="#data-users"></a>
</h3>
<p>If the failure percentage of withinVisitDates is high, a data user
should be careful with using the data. This check might indicate a
larger underlying conformance issue with either the event dates or
linkage with visits. At the same time, there might be a valid reason why
events do not happen within 7 days of the linked visit.</p>
<p>Make sure to understand why this check fails. Specifically, be
careful when using such data in outcomes research. Without specific
dates for an event, it is challenging to determine if an adverse event
occurred after a drug exposure, for example.</p>
<p>Note that this check specifically compares event dates to
<code>VISIT_OCCURRENCE</code> dates. There is no equivalent check for
<code>VISIT_DETAIL</code> that verifies whether the event date is within
(a week of) the visit detail start and end dates.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Katy Sadowski, Clair Blacketer, Ajit Londhe, Anthony Sena, Anthony Molinaro, Frank DeFalco, Pavel Grafkin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
