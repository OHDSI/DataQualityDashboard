<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>isPrimaryKey ‚Ä¢ DataQualityDashboard</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="isPrimaryKey">
<meta property="og:description" content="DataQualityDashboard">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">DataQualityDashboard</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/DataQualityDashboard.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/CheckTypeDescriptions.html">Check Type Definitions</a>
    </li>
    <li>
      <a href="../../articles/Thresholds.html">DQ Check Failure Thresholds</a>
    </li>
    <li>
      <a href="../../articles/CheckStatusDefinitions.html">DQ Check Statuses</a>
    </li>
    <li>
      <a href="../../articles/AddNewCheck.html">Adding a New Data Quality Check</a>
    </li>
    <li>
      <a href="../../articles/DqdForCohorts.html">DQD for Cohorts</a>
    </li>
    <li>
      <a href="../../articles/SqlOnly.html">SQL-only Mode</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    NEW! Data Quality Check Types
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/checkIndex.html">Index</a>
    </li>
    <li>
      <a href="../../articles/checks/cdmTable.html">cdmTable</a>
    </li>
    <li>
      <a href="../../articles/checks/cdmField.html">cdmField</a>
    </li>
    <li>
      <a href="../../articles/checks/cdmDatatype.html">cdmDatatype</a>
    </li>
    <li>
      <a href="../../articles/checks/isPrimaryKey.html">isPrimaryKey</a>
    </li>
    <li>
      <a href="../../articles/checks/isForeignKey.html">isForeignKey</a>
    </li>
    <li>
      <a href="../../articles/checks/isRequired.html">isRequired</a>
    </li>
    <li>
      <a href="../../articles/checks/fkDomain.html">fkDomain</a>
    </li>
    <li>
      <a href="../../articles/checks/fkClass.html">fkClass</a>
    </li>
    <li>
      <a href="../../articles/checks/plausibleAfterBirth.html">plausibleAfterBirth</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/DataQualityDashboard/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>isPrimaryKey</h1>
                        <h4 data-toc-skip class="author">John Gresh,
Katy Sadowski</h4>
            
            <h4 data-toc-skip class="date">2024-02-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/DataQualityDashboard/blob/HEAD/vignettes/checks/isPrimaryKey.Rmd" class="external-link"><code>vignettes/checks/isPrimaryKey.Rmd</code></a></small>
      <div class="hidden name"><code>isPrimaryKey.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p><strong>Level</strong>: Field check<br><strong>Context</strong>: Verification<br><strong>Category</strong>: Conformance<br><strong>Subcategory</strong>: Relational<br><strong>Severity</strong>: Fatal üíÄ<br></p>
</div>
<div class="section level2">
<h2 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h2>
<p>The number and percent of records that have a duplicate value in the
<strong>cdmFieldName</strong> field of the
<strong>cdmTableName</strong>.</p>
</div>
<div class="section level2">
<h2 id="definition">Definition<a class="anchor" aria-label="anchor" href="#definition"></a>
</h2>
<p>This check will make sure that all primary keys as specified in the
CDM version are truly unique keys. While this issue should generally be
prevented by primary key database constraints, some database management
systems such as Redshift do not enforce these constraints.</p>
<ul>
<li>
<em>Numerator</em>: The number of values in the column that appear
in more than 1 row</li>
<li>
<em>Denominator</em>: The total number of rows in the table</li>
<li>
<em>Related CDM Convention(s)</em>: Primary Key flag in <a href="https://ohdsi.github.io/CommonDataModel/index.html" class="external-link">CDM table
specs</a>
</li>
<li>
<em>CDM Fields/Tables</em>: By default, this check runs on all
primary key columns in the CDM</li>
<li>
<em>Default Threshold Value</em>: 0%</li>
</ul>
</div>
<div class="section level2">
<h2 id="user-guidance">User Guidance<a class="anchor" aria-label="anchor" href="#user-guidance"></a>
</h2>
<p>Multiple values for a primary key must be corrected. Failure to have
unique values for a primary key will result in incorrect results being
returned for queries that use these fields. This is especially true for
joins - joins on columns where multiple records are found where a single
record is assumed will result in inflation of the result set
(‚Äúfanning‚Äù). Also, some analytic frameworks may raise errors if more
than one record is found for an entity expected to be unique.</p>
<div class="section level3">
<h3 id="violated-rows-query">Violated rows query<a class="anchor" aria-label="anchor" href="#violated-rows-query"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="st">'@cdmTableName.@cdmFieldName'</span> <span class="kw">AS</span> violating_field,  </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  cdmTable.<span class="op">*</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  COUNT_BIG(<span class="op">*</span>) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> @cdmTableName.@cdmFieldName) <span class="kw">AS</span> dupe_count</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="kw">FROM</span> @cdmDatabaseSchema.@cdmTableName</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="kw">WHERE</span> dupe_count <span class="op">&gt;</span> <span class="dv">1</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> dupe_count <span class="kw">DESC</span>;</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="etl-developers">ETL Developers<a class="anchor" aria-label="anchor" href="#etl-developers"></a>
</h3>
<p>In some cases, a primary key error could arise from a 1:1
relationship modeled in the CDM that is modeled as a 1:n relationship in
the source system. For example, a single person could have multiple
patient identifiers in a source system. In most cases the multiple
records need to be collapsed into a single record.</p>
<p>Deduplication and merging of duplicate patient datasets is a
non-trivial process, and the intent of the multiple patient records
needs be ascertained prior to making design decisions. For example,
multiple records could exist for the same patient in a claims system who
was covered by the insurer during one period as a member of a first
group and then later re-entered the system as new member of a different
group (e.g.¬†new employer). In other cases multiple records could
indicate updates to the original record and the latest record could be
considered the ‚Äúcorrect‚Äù information.</p>
</div>
<div class="section level3">
<h3 id="data-users">Data Users<a class="anchor" aria-label="anchor" href="#data-users"></a>
</h3>
<p>Whenever possible, the ETL developer / data provider should be
involved in resolving a primary key error as this represents a critical
failure in the ETL process. Depending on the nature of the error, you
may be able to remove duplicate rows from a table to resolve the error;
however, proceed at your own risk as these duplicates could be the sign
of a deeper issue that needs to be resolved further upstream.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Katy Sadowski, Clair Blacketer, Ajit Londhe, Anthony Sena, Anthony Molinaro, Frank DeFalco, Pavel Grafkin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
