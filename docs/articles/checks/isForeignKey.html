<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>isForeignKey â€¢ DataQualityDashboard</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="isForeignKey">
<meta property="og:description" content="DataQualityDashboard">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">DataQualityDashboard</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/DataQualityDashboard.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/CheckTypeDescriptions.html">Check Type Definitions</a>
    </li>
    <li>
      <a href="../../articles/Thresholds.html">DQ Check Failure Thresholds</a>
    </li>
    <li>
      <a href="../../articles/CheckStatusDefinitions.html">DQ Check Statuses</a>
    </li>
    <li>
      <a href="../../articles/AddNewCheck.html">Adding a New Data Quality Check</a>
    </li>
    <li>
      <a href="../../articles/DqdForCohorts.html">DQD for Cohorts</a>
    </li>
    <li>
      <a href="../../articles/SqlOnly.html">SQL-only Mode</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    NEW! Data Quality Check Types
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/checkIndex.html">Index</a>
    </li>
    <li>
      <a href="../../articles/checks/cdmTable.html">cdmTable</a>
    </li>
    <li>
      <a href="../../articles/checks/cdmField.html">cdmField</a>
    </li>
    <li>
      <a href="../../articles/checks/cdmDatatype.html">cdmDatatype</a>
    </li>
    <li>
      <a href="../../articles/checks/isPrimaryKey.html">isPrimaryKey</a>
    </li>
    <li>
      <a href="../../articles/checks/isForeignKey.html">isForeignKey</a>
    </li>
    <li>
      <a href="../../articles/checks/isRequired.html">isRequired</a>
    </li>
    <li>
      <a href="../../articles/checks/fkDomain.html">fkDomain</a>
    </li>
    <li>
      <a href="../../articles/checks/fkClass.html">fkClass</a>
    </li>
    <li>
      <a href="../../articles/checks/plausibleAfterBirth.html">plausibleAfterBirth</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/DataQualityDashboard/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>isForeignKey</h1>
                        <h4 data-toc-skip class="author">Dmytry
Dymshyts, Katy Sadowski</h4>
            
            <h4 data-toc-skip class="date">2024-02-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/DataQualityDashboard/blob/HEAD/vignettes/checks/isForeignKey.Rmd" class="external-link"><code>vignettes/checks/isForeignKey.Rmd</code></a></small>
      <div class="hidden name"><code>isForeignKey.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p><strong>Level</strong>: Field check<br><strong>Context</strong>: Verification<br><strong>Category</strong>: Conformance<br><strong>Subcategory</strong>: Relational<br><strong>Severity</strong>: Fatal ðŸ’€<br></p>
</div>
<div class="section level2">
<h2 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h2>
<p>The number and percent of records that have a value in the
<strong>cdmFieldName</strong> field in the <strong>cdmTableName</strong>
table that does not exist in the <strong>fkTableName</strong> table.</p>
</div>
<div class="section level2">
<h2 id="definition">Definition<a class="anchor" aria-label="anchor" href="#definition"></a>
</h2>
<p>This check will make sure that all foreign keys as specified in the
CDM version have a value in the related primary key field. While this
issue should generally be prevented by foreign key database constraints,
some database management systems such as Redshift do not enforce such
constraints.</p>
<ul>
<li>
<em>Numerator</em>: The number of non-null values in the foreign key
column that do not exist in its corresponding primary key column</li>
<li>
<em>Denominator</em>: The total number of records in the table</li>
<li>
<em>Related CDM Convention(s)</em>: Foreign Key flag in <a href="https://ohdsi.github.io/CommonDataModel/index.html" class="external-link">CDM table
specs</a>
</li>
<li>
<em>CDM Fields/Tables</em>: By default, this check runs on foreign
key columns in the CDM</li>
<li>
<em>Default Threshold Value</em>: 0%</li>
</ul>
</div>
<div class="section level2">
<h2 id="user-guidance">User Guidance<a class="anchor" aria-label="anchor" href="#user-guidance"></a>
</h2>
<p>This check failure must be resolved. Failures in various fields could
impact analysis in many different ways, for example:</p>
<ul>
<li>If some important event or qualifier (for example, type concept) is
encoded by a non-existent concept, it canâ€™t be included in a concept set
or be a part of cohort definition or feature</li>
<li>If an event is linked to a non-existent person, it canâ€™t be included
in any cohort definition or analysis</li>
<li>If an event is linked to a non-existent visit, it will be missed in
visit-level cohort definition logic</li>
</ul>
<p>Many CDM columns are foreign keys to the <code>concept_id</code>
column in the <code>CONCEPT</code> table. See below for suggested
investigation steps for concept ID-related foreign key check
failures:</p>
<ul>
<li>An <code>x_concept_id</code> missing from the CONCEPT table might be
the result of an error in <code>SOURCE_TO_CONCEPT_MAP</code>; you may
check it this way:</li>
</ul>
<div class="section level3">
<h3 id="violated-rows-query">Violated rows query<a class="anchor" aria-label="anchor" href="#violated-rows-query"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="kw">FROM</span> @vocabSchema.source_to_concept_map </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="kw">LEFT</span> <span class="kw">JOIN</span> @vocabSchema.concept <span class="kw">ON</span> concept.concept_id <span class="op">=</span> source_to_concept_map.target_concept_id</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="kw">WHERE</span> concept.concept_id <span class="kw">IS</span> <span class="kw">NULL</span>;</span></code></pre></div>
<ul>
<li>Other types of concept-related errors can be investigated by
inspecting the source values for impacted rows as follows:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">-- @cdmTableName.@cdmFieldName is the x_concept_id or x_source_concept_id field in a CDM table</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">-- Inspect the contents of the x_source_value field to investigate the source of the error</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="st">'@cdmTableName.@cdmFieldName'</span> <span class="kw">AS</span> violating_field,  </span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  cdmTable.<span class="op">*</span>,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> <span class="st">'@cdmTableName.@cdmFieldName'</span>) <span class="kw">AS</span> num_violations_per_concept</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="kw">FROM</span> @cdmSchema.@cdmTableName  </span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="kw">LEFT</span> <span class="kw">JOIN</span> @vocabSchema.concept <span class="kw">on</span> @cdmTableName.@cdmFieldName <span class="op">=</span> concept.concept_id  </span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="kw">WHERE</span> concept.concept_id <span class="kw">IS</span> <span class="kw">NULL</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> num_violations_per_concept <span class="kw">DESC</span>; </span></code></pre></div>
<ul>
<li>2-billion concepts are a common source of foreign key issues; for
example, a check failure may arise if these concepts are used in some
tables but not fully represented in all relevant vocabulary tables
(CONCEPT, CONCEPT_RELATIONSHIP, etc.)</li>
<li>Similarly, make sure to check any hard-coded concept mappings in the
ETL as a potential source of the issue</li>
</ul>
<p>When an entry is missing from one of the other CDM tables (LOCATION,
PERSON, PROVIDER, VISIT_DETAIL, VISIT_OCCURRENCE, PAYER_PLAN_PERIOD,
NOTE, CARE_SITE, EPISODE), this likely originates from binding / key
generation errors in the ETL.</p>
</div>
<div class="section level3">
<h3 id="etl-developers">ETL Developers<a class="anchor" aria-label="anchor" href="#etl-developers"></a>
</h3>
<p>As above, mapping or binding logic needs to be amended in your ETL in
order to resolve this error.</p>
</div>
<div class="section level3">
<h3 id="data-users">Data Users<a class="anchor" aria-label="anchor" href="#data-users"></a>
</h3>
<p>Few options are available to correct this error without amending the
ETL code that populated your OMOP CDM. If a limited proportion of rows
are impacted, you could consider dropping them from your database;
however, do so at your own risk and only if you are confident that doing
so will not have a significant impact on the downstream use cases of
your CDM. A less aggressive approach could be to retain the affected
rows and document the scope of their impact (in order to resolve the
check failure, nullable values can be set to NULL and non-nullable
concept ID values to 0). However, it is strongly recommended to pursue
resolution further upstream in the ETL.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Katy Sadowski, Clair Blacketer, Ajit Londhe, Anthony Sena, Anthony Molinaro, Frank DeFalco, Pavel Grafkin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
